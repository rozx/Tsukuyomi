# 发布说明 - v0.7.2

## 版本信息
- **版本号**: 0.7.2
- **发布日期**: 2025年12月5日

---

## 🎉 新功能

### 1. 待办事项管理集成到 AI 服务
- **待办事项工具增强**：
  - 在翻译、润色、校对和助手服务中全面集成待办事项管理功能
  - AI 可以在执行任务时自动创建、更新和管理待办事项
  - 支持任务完成后自动标记相关待办事项为完成状态
  - 增强待办事项工具的描述清晰度，提升 AI 使用工具的准确性
- **共享辅助函数**：
  - 新增 `ai-task-helper.ts` 模块，实现 AI 任务服务的共享辅助函数
  - 消除重复代码，遵循 DRY 原则，提升代码可维护性
  - 统一工具调用循环处理、流式响应处理和错误处理逻辑
  - 优化任务类型处理的一致性和代码复用性
- **待办事项提示优化**：
  - 改进待办事项的系统提示词生成逻辑
  - 在工具调用后自动提醒 AI 评估待办事项进度
  - 支持待办事项摘要和简要列表功能
  - 增强待办事项与任务执行的关联性

### 2. 特殊指令管理功能
- **章节和书籍级别的特殊指令**：
  - 新增特殊指令管理功能，支持为章节和书籍设置翻译、润色、校对专用指令
  - 章节级别指令覆盖书籍级别指令，提供更精细的控制
  - 在翻译任务对话框中集成特殊指令编辑功能
  - 支持在不同任务类型中使用不同的特殊指令
- **特殊指令弹窗组件**：
  - 新增 `SpecialInstructionsPopover` 组件，提供便捷的特殊指令编辑界面
  - 优化指令编辑的用户体验和交互流程
  - 支持指令的保存、清空和继承逻辑

### 3. 翻译任务对话框
- **统一的任务配置界面**：
  - 新增 `TranslationTaskDialog` 组件，提供统一的翻译任务配置对话框
  - 支持翻译、润色、校对任务的统一配置入口
  - 集成特殊指令编辑功能，在启动任务前可自定义指令
  - 改进任务启动前的配置和预览体验

### 4. 书籍详情搜索替换功能增强
- **搜索替换改进**：
  - 增强书籍详情页面的搜索替换功能
  - 优化搜索和替换操作的性能和用户体验
  - 改进搜索结果的高亮显示和替换确认流程

### 5. 章节上下文支持增强
- **章节 ID 支持**：
  - 在 AI 服务中新增 `chapterId` 参数支持，增强上下文理解能力
  - AI 可以获取当前章节的上下文信息，提升翻译准确性
  - 优化章节级别上下文在翻译、润色、校对任务中的应用

---

## 🔧 改进与优化

### AI 服务优化
- **提示词连续性增强**：
  - 优化 AI 服务提示词，增强处理过程的连续性
  - 改进工具调用后的继续提示生成逻辑
  - 提升 AI 在处理长文本和复杂任务时的连贯性
- **代码结构优化**：
  - 重构 AI 任务服务代码，提取共享辅助函数
  - 消除重复代码，提升代码可维护性和可读性
  - 统一错误处理和流式响应处理逻辑

### 界面优化
- **加载界面改进**：
  - 清理 HTML 结构，优化加载屏幕样式
  - 改进初始加载体验和视觉效果
  - 优化应用启动时的用户反馈
- **冲突解决简化**：
  - 移除冲突解决对话框及相关逻辑
  - 简化同步冲突处理流程，优化用户体验
- **Toast 通知优化**：
  - 优化术语工具中的 Toast 通知处理逻辑
  - 改进通知的显示时机和内容准确性
  - 提升用户反馈的友好性和及时性

### 测试优化
- **测试结构改进**：
  - 重构测试文件，改进模拟数据和结构
  - 使用参数化模拟方法，提升测试的灵活性和可维护性
  - 优化测试文件的动态导入和服务方法模拟
  - 改进测试设置的可靠性和一致性
- **测试兼容性增强**：
  - 优化 IndexedDB 测试兼容性处理
  - 改进测试环境的模拟和设置
  - 提升测试在不同环境下的稳定性

### 开发工具优化
- **i18n 配置更新**：
  - 更新 i18n-ally 设置，移除 i18next 框架支持
  - 优化国际化开发工具的配置
- **开发体验改进**：
  - 改进代码组织和文件结构
  - 优化开发工具配置和工作流

---

## 🐛 问题修复

### 服务修复
- **同步服务修复**：
  - 修复同步数据处理中的潜在问题
  - 改进待办事项功能与同步服务的集成
  - 优化数据同步的稳定性和准确性

### 界面修复
- **HTML 结构修复**：
  - 修复 HTML 结构中的潜在问题
  - 改进页面加载和渲染性能
  - 优化样式和布局的一致性

### 测试修复
- **测试稳定性**：
  - 修复测试中的模拟问题
  - 改进测试的可靠性和执行效率
  - 优化测试环境的设置和清理逻辑

---

## 📝 技术细节

### 主要修改文件
- `src/services/ai/tasks/ai-task-helper.ts`：新增共享 AI 任务辅助函数模块（334 行）
- `src/services/ai/tasks/todo-helper.ts`：优化待办事项辅助函数，增强与 AI 服务的集成
- `src/services/ai/tasks/translation-service.ts`：集成待办事项管理和章节 ID 支持
- `src/services/ai/tasks/polish-service.ts`：集成待办事项管理和章节 ID 支持
- `src/services/ai/tasks/proofreading-service.ts`：集成待办事项管理和章节 ID 支持
- `src/services/ai/tasks/assistant-service.ts`：集成待办事项管理功能
- `src/services/ai/tools/todo-list-tools.ts`：增强待办事项工具描述和使用说明
- `src/components/dialogs/TranslationTaskDialog.vue`：新增翻译任务配置对话框（245 行）
- `src/components/novel/SpecialInstructionsPopover.vue`：新增特殊指令管理弹窗组件（161 行）
- `src/components/dialogs/BookDialog.vue`：增强书籍对话框，支持特殊指令编辑
- `src/components/dialogs/EditChapterDialog.vue`：增强章节编辑对话框，支持特殊指令编辑
- `src/components/layout/AppRightPanel.vue`：优化右侧面板，集成新功能
- `src/components/novel/TranslationProgress.vue`：优化翻译进度显示组件
- `src/components/novel/ChapterToolbar.vue`：添加特殊指令管理入口
- `src/components/settings/SyncSettingsTab.vue`：移除冲突解决对话框相关逻辑
- `src/__tests__/setup.ts`：优化测试设置，改进 IndexedDB 模拟
- `src/__tests__/*.test.ts`：重构测试文件，改进模拟和结构
- `.vscode/settings.json`：更新开发工具配置
- `.vscode/tasks.json`：新增开发任务配置
- `index.html`：优化 HTML 结构和加载屏幕样式

### 新增功能统计
- **新增功能**: 5 项
- **改进优化**: 8 项
- **问题修复**: 3 项
- **代码变更**: 约 3312 行新增，2768 行删除
- **修改文件**: 53 个文件

---

## 🎯 用户体验改进

1. **待办事项管理增强**：集成的待办事项管理功能使 AI 能够更好地规划和跟踪翻译任务，提升任务执行的系统性和可追溯性
2. **特殊指令支持**：新增的特殊指令管理功能提供了更精细的翻译控制，用户可以为不同章节和书籍设置专门的翻译指导
3. **任务配置改进**：统一的翻译任务对话框提供了更直观的任务配置体验，简化了任务启动流程
4. **代码质量提升**：重构的代码结构消除了重复代码，提升了可维护性和可扩展性
5. **界面体验优化**：改进的加载界面和简化的冲突处理流程提供了更流畅的用户体验
6. **上下文理解增强**：章节 ID 支持使 AI 能够更好地理解上下文，提升翻译准确性

---

## 🔄 升级建议

本次更新主要聚焦于：

1. **待办事项集成**：待办事项管理功能的全面集成使 AI 服务能够更好地规划和跟踪任务，显著提升任务执行的系统性和可管理性
2. **特殊指令管理**：新增的特殊指令管理功能提供了更精细的翻译控制，特别适合需要特定翻译风格的章节和书籍
3. **代码质量提升**：重构的代码结构消除了重复代码，提升了可维护性和可扩展性，为未来功能开发奠定良好基础
4. **用户体验优化**：改进的界面和简化的流程提供了更流畅的使用体验

建议所有用户升级以获得更好的使用体验。特别是待办事项管理功能和特殊指令支持将显著提升翻译工作的组织性和精确性。

---

## 📚 相关文档

- 项目架构文档：`AGENTS.md`
- 翻译指南：`docs/TRANSLATION_GUIDE.md`
- 主题指南：`docs/THEME_GUIDE.md`
- 组合函数检查报告：`docs/COMPOSABLES_CHECK_REPORT.md`
- 组合函数测试摘要：`docs/COMPOSABLES_TESTS_SUMMARY.md`

---

## 🙏 致谢

感谢所有为本次版本做出贡献的开发者。

---

*本文档由自动化工具生成，如有疑问请提交 Issue。*
