# 发布说明 - v0.8.4

## 版本信息

- **版本号**: 0.8.4
- **发布日期**: 2026年1月19日

---

## 🎉 新功能

### 1. 批量章节摘要 (Batch Chapter Summary)

- **批量处理面板**: 新增 `BatchSummaryPanel` 组件，支持一键为全书或选定章节生成缺失的摘要。
- **实时进度反馈**: 支持显示当前正在处理的章节标题及整体进度。
- **任务控制**: 集成 AbortController，支持用户随时安全终止批量生成任务。
- **智能过滤**: 自动识别并仅处理缺失摘要的章节，避免重复消耗 AI 额度。

### 2. AI 任务上下文管理增强

- **关联信息注入**: 在翻译、润色、校对和摘要任务中，自动注入相关的术语表和角色设定信息，显著提升 AI 生成内容的准确性和一致性。
- **通用助手工具**: 引入 `ai-task-helper` 模块，统一管理 AI 任务的上下文构建、模型选择和错误处理逻辑。
- **提示词优化**: 针对章节摘要任务优化了 Prompt，使其更能捕捉章节的核心剧情。

---

## 🔧 改进与优化

### UI/UX 体验

- **同步状态防抖**: 为顶部状态栏的同步倒计时添加了防抖逻辑，避免高频更新导致的界面微颤和性能开销。
- **摘要生成交互**: 优化了单个章节摘要生成后的 UI 自动刷新机制，无需手动刷新即可看到新生成的摘要。
- **书籍详情页**: 在批量摘要入口处直观显示当前书籍标题及待处理章节数。

### 代码质量与性能

- **异步控制优化**: 核心 AI 服务全面采用异步流式处理及可中断机制，提升应用响应速度。
- **Vue 模板优化**: 清理了部分组件中的冗余事件监听和计算属性。

---

## 🐛 问题修复

### 核心功能修复

- **章节排序修复**: 修复了章节列表中拖拽排序可能导致的位置偏移问题。
- **摘要显示修复**: 修复了某些情况下生成摘要后面板标题显示空白的 Bug。
- **内存泄漏预防**: 增强了 AI 任务销毁时的资源清理。

---

## 📝 技术细节

### 主要修改文件

- `src/components/novel/BatchSummaryPanel.vue`: 新增批量摘要管理面板。
- `src/services/ai/tasks/chapter-summary-service.ts`: 重构摘要服务，支持批量与控制。
- `src/services/ai/tasks/utils/ai-task-helper.ts`: 新增 AI 任务通用辅助工具。
- `src/components/AppHeader.vue`: 添加同步状态倒计时防抖。
- `src/services/ai/tasks/translation-service.ts`: 增强上下文注入。
- `src/services/ai/tasks/polishing-service.ts`: 增强关联词汇支持。
- `src/services/ai/tasks/proofreading-service.ts`: 增强校对背景信息。

### 代码统计

- **新增功能**: 2 大项 (批量摘要、上下文助手)
- **改进优化**: 3 类
- **问题修复**: 3 类
- **代码质量**: 全面通过 type-check 和 eslint 静态检查

---

## 🎯 用户体验改进

1. **更强大的批量能力**: 告别逐章点击，一键完成整本书的摘要提取，极大提升创作效率。
2. **更聪明的 AI**: 现在的 AI 能够“记住”你的术语和角色设定，无论是翻译还是写摘要都更具专业性。
3. **更顺畅的界面**: 修复了烦人的拖拽偏移问题，同步倒计时也变得更加静默优雅。

---

## 🔄 升级建议

本次更新重点提升了 **AI 创作效率** 和 **内容一致性**。

建议所有深度使用 AI 功能的用户升级，尤其是：

- 拥有大量章节需要整理摘要的用户。
- 对翻译一致性（词汇、角色）有较高要求的用户。

---

## 🙏 致谢

感谢所有在本次版本开发中提供反馈和建议的伙伴们。

---

_本文档由 Antigravity 自动化工具生成。_
