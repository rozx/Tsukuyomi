<!doctype html>
<html lang="zh-CN" class="dark">
  <head>
    <title><%= productName %></title>

    <meta charset="utf-8" />
    <meta name="description" content="<%= productDescription %>" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta
      name="viewport"
      content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width<% if (ctx.mode.cordova || ctx.mode.capacitor) { %>, viewport-fit=cover<% } %>"
    />

    <link rel="icon" type="image/png" sizes="128x128" href="icons/favicon-128x128.png" />
    <link rel="icon" type="image/png" sizes="96x96" href="icons/favicon-96x96.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png" />
    <link rel="icon" type="image/ico" href="favicon.ico" />
  </head>

  <!--
    主题颜色说明（来自 src/constants/theme.ts）：
    - 增强的背景渐变：多层月夜效果，添加对比色
      - 对比色：温暖的琥珀色 rgba(255, 183, 77, ...) 和柔和的紫色 rgba(186, 104, 200, ...)
      - Highlight（薄藍）rgba(109, 136, 168, ...) = Theme.translationText 的基础色
      - Accent（銀月）rgba(174, 183, 198, ...) = Theme.colors.accent
      - Primary（月白）rgba(233, 237, 245, ...) = Theme.colors.primary.DEFAULT
      - Secondary（影墨）渐变：#0A0C0F, #0F1114, #1C1F26, #242730, #2C2F3A
  -->
  <body
    style="
      margin: 0;
      padding: 0;
      background-image:
        radial-gradient(circle at 50% 20%, rgba(255, 183, 77, 0.08), transparent 60%),
        radial-gradient(circle at 70% 30%, rgba(186, 104, 200, 0.06), transparent 65%),
        radial-gradient(circle at 15% 15%, rgba(109, 136, 168, 0.35), transparent 45%),
        radial-gradient(circle at 85% 10%, rgba(174, 183, 198, 0.28), transparent 50%),
        radial-gradient(circle at 25% 50%, rgba(109, 136, 168, 0.15), transparent 55%),
        radial-gradient(circle at 75% 50%, rgba(174, 183, 198, 0.18), transparent 60%),
        radial-gradient(circle at 10% 85%, rgba(109, 136, 168, 0.12), transparent 65%),
        radial-gradient(circle at 90% 90%, rgba(174, 183, 198, 0.15), transparent 70%),
        radial-gradient(circle at 50% 50%, rgba(233, 237, 245, 0.05), transparent 75%),
        linear-gradient(135deg, #0A0C0F 0%, #0F1114 20%, #1C1F26 50%, #242730 80%, #2C2F3A 100%);
      background-attachment: fixed;
      overflow: hidden;
    "
  >
    <!--
      初始加载屏幕 - 在 Vue 挂载前显示
      主题颜色说明（来自 src/constants/theme.ts）：
      - 背景渐变：增强的多层月夜效果，添加对比色（与 body 相同）
      - 加载动画边框：Highlight（薄藍）#6D88A8 = Theme.translationText 的基础色
      - 文字颜色：Primary（月白）rgba(233, 237, 245, ...) = Theme.colors.primary.DEFAULT
    -->
    <div
      id="initial-loading-screen"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image:
          radial-gradient(circle at 50% 20%, rgba(255, 183, 77, 0.08), transparent 60%),
          radial-gradient(circle at 70% 30%, rgba(186, 104, 200, 0.06), transparent 65%),
          radial-gradient(circle at 15% 15%, rgba(109, 136, 168, 0.35), transparent 45%),
          radial-gradient(circle at 85% 10%, rgba(174, 183, 198, 0.28), transparent 50%),
          radial-gradient(circle at 25% 50%, rgba(109, 136, 168, 0.15), transparent 55%),
          radial-gradient(circle at 75% 50%, rgba(174, 183, 198, 0.18), transparent 60%),
          radial-gradient(circle at 10% 85%, rgba(109, 136, 168, 0.12), transparent 65%),
          radial-gradient(circle at 90% 90%, rgba(174, 183, 198, 0.15), transparent 70%),
          radial-gradient(circle at 50% 50%, rgba(233, 237, 245, 0.05), transparent 75%),
          linear-gradient(135deg, #0A0C0F 0%, #0F1114 20%, #1C1F26 50%, #242730 80%, #2C2F3A 100%);
        background-attachment: fixed;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.3s ease-out;
      "
    >
      <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem">
        <!-- 加载动画 -->
        <!-- border-top-color: #6D88A8 = Highlight（薄藍），来自 Theme.translationText 的基础色 -->
        <div
          style="
            width: 4rem;
            height: 4rem;
            border: 4px solid rgba(233, 237, 245, 0.1);
            border-top-color: #6D88A8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
          "
        ></div>
        <!-- color: rgba(233, 237, 245, 0.9) = Primary（月白），来自 Theme.colors.primary.DEFAULT -->
        <p
          style="color: rgba(233, 237, 245, 0.9); font-size: 1.125rem; font-weight: 500; margin: 0"
        >
          正在加载应用...
        </p>
        <!-- color: rgba(233, 237, 245, 0.6) = Primary（月白）60% 透明度 -->
        <p style="color: rgba(233, 237, 245, 0.6); font-size: 0.875rem; margin: 0">请稍候</p>
      </div>
    </div>

    <style>
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>

    <script>
      (function () {
        'use strict';
        const loadingScreen = document.getElementById('initial-loading-screen');
        if (!loadingScreen) return;

        // 防止多次调用
        let isHiding = false;
        let observer = null;
        let checkInterval = null;

        function hideLoadingScreen() {
          // 如果已经在隐藏过程中，直接返回
          if (isHiding || loadingScreen.style.display === 'none') {
            return;
          }
          isHiding = true;

          // 清理所有监听器
          if (observer) {
            observer.disconnect();
            observer = null;
          }
          if (checkInterval) {
            clearInterval(checkInterval);
            checkInterval = null;
          }

          // 淡出动画
          loadingScreen.style.opacity = '0';
          setTimeout(function () {
            if (loadingScreen && loadingScreen.parentNode) {
              loadingScreen.style.display = 'none';
              // 恢复 body 的 overflow（CSS 会处理背景）
              document.body.style.overflow = '';
            }
          }, 300);
        }

        function checkVueApp() {
          // 检查多种可能的 Vue/Quasar 挂载点
          const app = document.getElementById('q-app');
          // 必须确保 #q-app 内有内容，说明 Vue 已经渲染
          if (app && app.childElementCount > 0) {
            return true;
          }

          // 检查其他明确的 Vue/Quasar 结构
          return !!document.querySelector('[data-v-app], .q-layout, .q-page-container');
        }

        // 方法1: 监听 DOM 变化，检测 Vue 应用挂载
        if (document.body) {
          observer = new MutationObserver(function () {
            if (checkVueApp()) {
              observer.disconnect();
              observer = null;
              // 给 Vue 一点时间完成初始渲染
              setTimeout(hideLoadingScreen, 150);
            }
          });

          observer.observe(document.body, {
            childList: true,
            subtree: true,
          });
        } else {
          document.addEventListener('DOMContentLoaded', function () {
            if (document.body && !observer) {
              observer = new MutationObserver(function () {
                if (checkVueApp()) {
                  observer.disconnect();
                  observer = null;
                  setTimeout(hideLoadingScreen, 150);
                }
              });

              observer.observe(document.body, {
                childList: true,
                subtree: true,
              });
            }
          });
        }

        // 方法2: 轮询检查（作为备用方案）
        let checkCount = 0;
        const maxChecks = 1000; // 最多检查 50 秒（50ms * 1000）
        checkInterval = setInterval(function () {
          checkCount++;
          if (checkVueApp()) {
            clearInterval(checkInterval);
            checkInterval = null;
            if (observer) {
              observer.disconnect();
              observer = null;
            }
            setTimeout(hideLoadingScreen, 150);
          } else if (checkCount >= maxChecks) {
            // 超时保护：50秒后强制隐藏
            clearInterval(checkInterval);
            checkInterval = null;
            if (observer) {
              observer.disconnect();
              observer = null;
            }
            hideLoadingScreen();
          }
        }, 50);

        // 方法3: 页面加载完成后也尝试隐藏（作为最后保障）
        window.addEventListener('load', function () {
          setTimeout(function () {
            if (loadingScreen && loadingScreen.style.display !== 'none' && !isHiding) {
              if (observer) {
                observer.disconnect();
                observer = null;
              }
              if (checkInterval) {
                clearInterval(checkInterval);
                checkInterval = null;
              }
              hideLoadingScreen();
            }
          }, 500);
        });
      })();
    </script>

    <!-- quasar:entry-point -->
    <!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "3ba81e5a0c2646c3b72b4cdecdb1df6b"}'></script><!-- End Cloudflare Web Analytics -->
  </body>
</html>
