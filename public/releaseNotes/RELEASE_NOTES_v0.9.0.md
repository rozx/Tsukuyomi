# 发布说明 - v0.9.0

## 版本信息

- **版本号**: 0.9.0
- **发布日期**: 2026年2月6日
- **基于版本**: v0.8.4

---

## 🌟 核心更新：Agentic AI 智能体架构

v0.9.0 是 Tsukuyomi 进化史上最重要的里程碑。我们引入了全新的 **Agentic AI** 架构，从根本上改变了与 AI 的交互方式。AI 不再只是一个被动的回答者，而是一个能够**主动思考、规划并执行复杂任务**的智能助手。

- **思考过程 (Thinking Process)**: AI 现在会展示其思考、分析和决策的完整过程，让您了解它为何做出某些决定。
- **工具调用循环 (Tool Use Loop)**: AI 具备了自主调用工具的能力。它可以在回答您的问题前，主动搜索帮助文档、读取书籍内容、查询记忆库，甚至连续执行多步操作以完成复杂任务。
- **状态机驱动的任务运行器**: 引入了基于状态机的任务执行系统，大幅提升了 AI 任务（如翻译、润色）的稳定性和可观测性。

---

## 🎉 新功能

### 1. 全新书籍管理系统 (New Books Management)

- **书籍列表页 (BooksPage)**: 完全重构的书籍管理界面，支持卡片式展示和网格布局。
- **多维搜索与排序**: 支持按标题、作者、标签等字段搜索，并提供 12 种排序方式（如按更新时间、章节数、字数等）。
- **Web 抓取器 (Web Scraper)**: 新增 `NovelScraperDialog`，支持从 Syosetu, Kakuyomu 等源站一键抓取小说。
  - **智能章节筛选**: 在导入前预览章节列表，支持勾选、全选或按索引范围灵活导入。
- **批量操作**: 支持批量章节摘要生成，自动跳过已处理章节。

### 2. 专业级翻译工作流 (Advanced Translation Workflow)

- **润色与校对服务**: 新增独立的 **润色 (Polishing)** 和 **校对 (Proofreading)** 任务类型，配合专用 Prompt，提供出版级的内容优化。
- **翻译进度面板**: 全新的 `TranslationProgress` 组件，提供毫秒级的任务进度反馈、实时日志流和中断控制。
- **智能上下文构建**: 翻译任务现在会自动检索并注入相关的 **术语表**、**角色设定** 和 **记忆片段**，显著解决长篇小说翻译中的"遗忘"和"不一致"问题。

### 3. 记忆系统 2.0 (Memory System 2.0)

- **记忆附件 (Attachments)**: 记忆条目现在支持附件，AI 可以读取更丰富的背景资料。
- **引用可视化**: 阅读界面新增 **记忆引用计数** 和 **悬浮预览**，直观展示当前章节与哪些记忆点强相关。
- **全面管理**: 新增记忆管理面板，支持增删改查、搜索和列表视图，方便维护庞大的世界观设定。

### 4. 智能助手与帮助系统

- **AppRightPanel**: 全新的右侧面板，集成了 AI 聊天、工具调用和上下文管理。
- **应用内帮助系统**: 内置完整的 Markdown 帮助文档库。
- **AI 文档导航**: 遇到问题直接问 AI，它会自动搜索内部文档并给出精准解答。

---

## 🔧 改进与优化

### 核心算法与性能

- **动态规划引号配对**: 引入 DP 算法重写了翻译规范化器，精准解决翻译中常见的引号不匹配、嵌套错误问题。
- **Schema 优化 (-20% Token)**: 重构了 AI 输出的数据结构，通过短键名映射和整数索引优化，**减少了约 20% 的 Token 消耗**，同时提升了生成速度。
- **空白内容过滤**: 自动检测并跳过空白或仅含标点的段落，避免无效的 AI 调用。
- **并发控制**: 优化了批量翻译的并发限制（调整为 30），在速度和稳定性之间取得更好平衡。

### 构建与开发体验

- **macOS 完善支持**: 完整的 Electron 构建流程，包含代码签名 (Code Signing)、公证 (Notarization) 和权限配置。
- **类型安全**: 全面增强了代码库的 TypeScript 类型定义，特别是针对 Electron 菜单和 AI 工具调用。
- **图标管理**: 集成 Quasar Icon Genie，统一管理多平台图标资源。

---

## 🐛 问题修复

- 修复了 quote pairing 算法在处理复杂嵌套引号时的逻辑错误。
- 修复了 AI 任务在网络波动下的状态同步异常。
- 修复了书籍列表页在移动端和超宽屏下的布局错位问题。
- 修复了批量翻译时偶发的任务卡死问题。
- 解决了一些组件的内存泄漏隐患。

---

## 📝 技术细节

### 代码统计

- **变更文件**: 406 个文件
- **代码增减**: +50,486 行 / -12,953 行
- **主要新增模块**:
  - `src/services/ai/agent/`: Agentic AI 核心架构
  - `src/services/ai/tasks/`: 专用任务服务（翻译/润色/校对）
  - `src/components/books/`: 新版书籍管理 UI
  - `src/utils/text-matcher.ts`: 高级文本匹配算法

### 架构变更

- 引入 `TaskRunner` 类管理长运行任务。
- 拆分 `AIProcessingStore` 为更细粒度的状态管理。
- 实现 `ToolRegistry` pattern 用于 AI 工具扩展。

---

## 🎯 用户体验改进

1. **可视化思考**: 看着 AI "思考"是一种全新的体验，让你对结果更具信心。
2. **无缝导入**: 从"复制链接"到"开始阅读"的流程被缩短到极致，章节筛选功能让导入更加随心所欲。
3. **掌控感**: 详细的进度条和日志，让你不再对着加载动画发呆，清楚知道 AI 正在翻译哪一段。
4. **上下文感知**: 在阅读时随时查看关联的记忆和设定，不再为"这个人物是谁"困扰。

---

## 🔄 升级建议

**强烈建议所有用户升级到 v0.9.0**。

这个版本不仅仅是功能的增加，更是底层架构的质变。Agentic AI 的引入为未来更强大的自动化功能奠定了基础。新的翻译和记忆系统将显著提升您的阅读和创作体验。

---

## 📚 相关文档

- **新手入门**: `help/front-page.md`
- **书籍列表指南**: `help/books-page-guide.md`
- **AI 翻译详解**: `help/book-details-translation.md`
- **记忆系统指南**: `help/book-details-memory.md`

---

## 🙏 致谢

感谢所有测试人员和反馈贡献者。特别感谢社区对新 AI 架构的建议。

---

_本文档由自动化工具生成，基于 git diff v0.8.4..v0.9.0_
