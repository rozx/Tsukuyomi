# 发布说明 - v0.7.7

## 版本信息
- **版本号**: 0.7.7
- **发布日期**: 2025年12月18日

---

## 🎉 新功能

### 1. 全文搜索功能
- **基于 Fuse.js 的全文索引服务**：
  - 新增 `FullTextIndexService`，提供快速全文搜索功能
  - 支持在原文和翻译文本中进行全文搜索
  - 使用 Fuse.js 实现模糊搜索和相关性排序
  - 支持按章节 ID 限制搜索范围
  - 支持仅搜索包含翻译的段落
  - 支持限制搜索结果数量，提升搜索性能
- **索引管理与缓存**：
  - 实现 LRU 内存缓存机制，避免重复加载索引
  - 自动检测章节内容变化并更新索引
  - 支持索引的增量更新，提升更新效率
  - 优化索引存储结构，支持 `lastUpdated` 字段
- **段落搜索工具增强**：
  - 在 `find_paragraph_by_keywords` 工具中集成全文搜索功能
  - 提供更快速和准确的段落查找能力
  - 支持复杂的搜索查询和模式匹配

### 2. Memory 服务缓存优化
- **LRU 缓存机制**：
  - 实现内存缓存，最多缓存 200 个记忆条目
  - 使用 LRU（最近最少使用）策略管理缓存
  - 自动清理过期缓存，保持内存使用效率
  - 缓存命中时直接返回，避免数据库访问
- **搜索结果缓存**：
  - 新增搜索结果缓存，缓存关键词组合到记忆 ID 列表的映射
  - 缓存 TTL 为 2 分钟，平衡性能和数据新鲜度
  - 最多缓存 100 个搜索结果，提升重复搜索的性能
  - 自动清理过期和过大的缓存
- **性能优化**：
  - 优化记忆访问性能，减少数据库查询次数
  - 改进缓存更新逻辑，确保数据一致性
  - 增强缓存清理机制，防止内存泄漏

### 3. 待办事项批量更新支持
- **批量更新功能**：
  - 在 `update_todos` 工具中新增批量更新支持
  - 支持一次性更新多个待办事项的内容或状态
  - 提供详细的批量操作反馈和错误处理
  - 优化批量更新的性能和可靠性
- **操作反馈增强**：
  - 改进批量更新的操作信息报告
  - 支持部分成功的情况处理
  - 提供更详细的错误信息

### 4. 翻译进度组件任务指示器增强
- **任务状态可视化**：
  - 增强 `TranslationProgress` 组件的任务指示器显示
  - 改进任务状态的视觉反馈
  - 优化任务列表的展示和交互
- **待办事项集成**：
  - 改进待办事项在翻译进度中的显示
  - 优化待办事项与任务的关联展示

---

## 🔧 改进与优化

### 翻译规范化增强
- **引号和标点处理优化**：
  - 增强翻译文本中的引号规范化功能
  - 改进标点符号的规范化处理
  - 优化章节内容处理逻辑
- **测试覆盖增强**：
  - 新增翻译规范化测试用例
  - 改进测试覆盖范围

### 空段落处理
- **服务层空段落支持**：
  - 在翻译、润色、校对服务中新增空段落处理
  - 改进对空段落的验证和处理逻辑
  - 优化任务完成度验证，正确处理空段落情况

### 格式化与符号使用指南
- **服务提示词增强**：
  - 在翻译、润色、校对服务中增强格式化指南
  - 改进符号使用规范的说明
  - 优化提示词的结构和可读性

### 代码重构与优化
- **AI 任务辅助函数重构**：
  - 重构 `ai-task-helper.ts`，消除重复代码
  - 改进代码结构和可维护性
  - 优化函数组织和抽象层次
- **服务代码简化**：
  - 简化翻译、润色、校对服务的代码结构
  - 移除重复逻辑，提升代码复用性
  - 改进错误处理和验证逻辑

### IndexedDB 版本更新
- **数据库结构优化**：
  - 更新 IndexedDB 版本以支持全文索引的 `lastUpdated` 字段
  - 改进数据库迁移逻辑
  - 优化索引存储结构

---

## 🐛 问题修复

### 段落工具修复
- **批量替换逻辑优化**：
  - 修复批量替换功能中的边界情况处理
  - 改进替换逻辑的准确性和可靠性
  - 优化错误处理和用户反馈

### 记忆参数测试修复
- **测试数据更新**：
  - 修复记忆参数测试中的属性设置问题
  - 更新测试用例以反映最新的数据模型
  - 改进测试的准确性和覆盖范围

### 动画过渡优化
- **Luna 预设主题优化**：
  - 调整过渡处理逻辑，改进动画管理
  - 优化动画性能和视觉效果

---

## 📝 技术细节

### 主要修改文件
- `src/services/full-text-index-service.ts`：新增全文索引服务（+478 行）
- `src/services/memory-service.ts`：增强 Memory 服务，新增缓存功能（+273 行，-部分代码）
- `src/services/ai/tasks/ai-task-helper.ts`：重构任务辅助函数（+262 行，-部分代码）
- `src/services/ai/tools/paragraph-tools.ts`：集成全文搜索，优化批量替换（+285 行，-部分代码）
- `src/services/ai/tools/todo-list-tools.ts`：新增批量更新支持（+142 行，-部分代码）
- `src/services/ai/tools/memory-tools.ts`：增强记忆工具功能（+99 行）
- `src/components/novel/TranslationProgress.vue`：增强任务指示器（+67 行）
- `src/services/chapter-content-service.ts`：新增章节内容服务方法（+45 行）
- `src/services/chapter-service.ts`：新增章节服务方法（+23 行）
- `src/__tests__/memory-service.test.ts`：增强记忆服务测试（+403 行）
- `src/__tests__/include-memory-parameter.test.ts`：新增记忆参数测试（+438 行）
- `src/__tests__/memory-helper.test.ts`：新增记忆辅助函数测试（+153 行）
- `src/__tests__/todo-list-tools.test.ts`：增强待办事项工具测试（+133 行）
- `src/services/ai/tasks/translation-service.ts`：代码重构和优化（+142 行，-部分代码）
- `src/services/ai/tasks/polish-service.ts`：代码重构和优化（+105 行，-部分代码）
- `src/services/ai/tasks/proofreading-service.ts`：代码重构和优化（+74 行，-部分代码）
- `src/utils/indexed-db.ts`：更新 IndexedDB 版本（+16 行）
- `src/utils/translation-normalizer.ts`：增强翻译规范化（+5 行）
- `package.json`：版本号更新至 0.7.7，新增 Fuse.js 依赖（+3 行）
- `src/constants/version.ts`：版本号更新至 0.7.7（+2 行）

### 新增功能统计
- **新增功能**: 4 项
- **改进优化**: 6 项
- **问题修复**: 3 项
- **代码变更**: 约 3213 行新增，532 行删除
- **修改文件**: 32 个文件

---

## 🎯 用户体验改进

1. **搜索性能提升**：新增的全文搜索功能使用 Fuse.js 提供快速、准确的段落搜索，显著提升了查找相关内容的效率
2. **记忆访问优化**：Memory 服务的 LRU 缓存机制大幅提升了记忆访问速度，特别是在频繁访问相同记忆时
3. **批量操作支持**：待办事项的批量更新功能使 AI 能够更高效地管理任务，提升了任务管理的灵活性
4. **任务可视化增强**：改进的翻译进度组件提供了更清晰的任务状态反馈，帮助用户更好地了解任务进度
5. **代码质量提升**：重构的代码结构消除了重复代码，提升了可维护性和可扩展性
6. **搜索体验改进**：全文搜索功能的集成使段落查找更加便捷和准确，支持复杂的搜索查询

---

## 🔄 升级建议

本次更新主要聚焦于：

1. **全文搜索功能**：新增的全文搜索功能使用 Fuse.js 提供快速、准确的段落搜索，特别适合需要频繁查找内容的用户
2. **性能优化**：Memory 服务的缓存机制显著提升了记忆访问性能，对于大量使用记忆功能的用户将带来明显的性能提升
3. **批量操作增强**：待办事项的批量更新功能提升了任务管理的效率，特别适合复杂任务的规划和管理
4. **代码质量改进**：重构的代码结构提升了应用的稳定性和可维护性

建议所有用户升级以获得更好的使用体验。特别是对于需要频繁搜索段落或使用记忆功能的用户，全文搜索和缓存优化将显著提升使用体验。

---

## 📚 相关文档

- 项目架构文档：`AGENTS.md`
- 翻译指南：`docs/TRANSLATION_GUIDE.md`
- 主题指南：`docs/THEME_GUIDE.md`
- 批量替换示例：`docs/batch-replace-examples.md`

---

## 🙏 致谢

感谢所有为本次版本做出贡献的开发者。

---

*本文档由自动化工具生成，如有疑问请提交 Issue。*
