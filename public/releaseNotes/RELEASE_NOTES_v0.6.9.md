# 发布说明 - v0.6.9

## 版本信息
- **版本号**: 0.6.9
- **发布日期**: 2025年11月28日

---

## 🎉 新功能

### 1. 章节管理界面重构
- **章节工具栏组件 (ChapterToolbar)**：
  - 新增独立的章节工具栏组件，提供统一的章节操作界面
  - 集成撤销/重做功能，支持操作历史管理
  - 支持编辑模式切换、翻译操作、导出功能等常用操作
  - 显示术语和角色使用统计，便于了解章节内容
- **章节内容面板 (ChapterContentPanel)**：
  - 新增专门的章节内容编辑和翻译面板
  - 优化章节内容的展示和编辑体验
  - 改进段落翻译和编辑的交互流程
- **卷和章节列表组件 (VolumesList)**：
  - 新增卷和章节的列表管理组件
  - 支持卷和章节的层级展示和管理
  - 提供更直观的书籍结构导航

### 2. 代理设置增强
- **默认代理配置**：
  - 新增默认代理配置功能，简化代理设置流程
  - 支持为不同域名自动应用相应的代理设置
  - 改进代理配置的用户体验
- **域名提取工具**：
  - 新增 `domain-utils.ts` 工具模块，提供域名提取功能
  - 支持从 URL 中提取根域名，自动识别特殊二级域名后缀
  - 集成到代理设置中，实现智能域名匹配

### 3. 撤销/重做功能增强
- **操作历史管理**：
  - 增强撤销/重做功能的实现，支持更复杂的操作历史
  - 改进操作描述的显示，提供更清晰的操作反馈
  - 优化操作历史的存储和恢复机制
- **UI 集成**：
  - 在章节工具栏中集成撤销/重做按钮
  - 显示可撤销/重做的操作描述，提升用户体验

### 4. 对话框和弹出框组件
- **章节和卷管理对话框**：
  - 新增 `AddChapterDialog`、`EditChapterDialog`、`DeleteChapterConfirmDialog`
  - 新增 `AddVolumeDialog`、`EditVolumeDialog`、`DeleteVolumeConfirmDialog`
  - 提供统一的章节和卷管理界面
- **信息弹出框**：
  - 新增 `CharacterPopover`、`TermPopover`、`KeyboardShortcutsPopover`
  - 提供快速查看角色、术语和快捷键信息的功能

### 5. 翻译进度显示优化
- **自动折叠功能**：
  - 实现 `TranslationProgress` 组件中非活动任务的自动折叠
  - 减少界面干扰，聚焦当前活跃的翻译任务
  - 提升翻译进度显示的清晰度

### 6. 助手提示增强
- **当前时间显示**：
  - 在助手提示中添加当前时间显示
  - 为 AI 助手提供时间上下文信息
  - 优化时间显示的位置和格式

### 7. 操作统计功能
- **唯一操作计数**：
  - 在 `BookDetailsPage` 中添加术语和角色的唯一操作计数
  - 显示章节中使用的术语和角色数量
  - 帮助用户了解章节内容的复杂度

---

## 🔧 改进与优化

### 章节内容管理优化
- **保存和更新逻辑优化**：
  - 优化章节内容保存和更新逻辑，提升数据一致性
  - 改进章节内容加载机制，减少不必要的重载
  - 优化 UI 更新逻辑，确保界面状态与数据同步
- **异步操作改进**：
  - 集成 `co` 库用于各种组件中的异步操作
  - 改进异步操作的错误处理和状态管理
  - 提升异步操作的性能和可靠性

### 服务层优化
- **角色和术语服务**：
  - 简化角色和术语服务中的方法调用
  - 优化服务层的代码结构，提升可维护性
  - 改进服务的错误处理和日志记录
- **章节服务**：
  - 优化章节服务的实现，提升性能
  - 改进章节数据的处理逻辑

### 代码质量提升
- **类型安全改进**：
  - 改进各种组件的测试用例和类型安全
  - 增强 TypeScript 类型检查的覆盖度
  - 修复类型相关的潜在问题
- **事件处理优化**：
  - 更新 `ChapterToolbar` 和 `BookDetailsPage` 中的事件处理
  - 优化组件间的事件通信机制
  - 改进事件处理的性能和可维护性

### 加载状态和确认对话框
- **删除操作确认**：
  - 增强删除操作的确认对话框
  - 改进加载状态的显示，提供更好的用户反馈
  - 优化删除操作的流程和安全性

---

## 🐛 问题修复

### 翻译和润色服务修复
- **输出描述优化**：
  - 修复 `PolishService` 和 `TranslationService` 中的输出描述
  - 改进服务输出的清晰度和准确性
  - 优化错误信息的显示

### 代理设置修复
- **描述清晰度**：
  - 更新代理描述以提高清晰度
  - 修复代理配置相关的显示问题

### 助手提示修复
- **时间显示位置**：
  - 修复助手提示中当前时间显示的位置
  - 确保时间信息正确显示在提示中

### 代码清理
- **日志记录优化**：
  - 移除 `BaseScraper` 中不必要的日志记录
  - 减少冗余日志输出，提升性能

---

## 📝 技术细节

### 主要修改文件
- `src/pages/BookDetailsPage.vue`：大幅重构，简化代码结构，提升可维护性
- `src/components/novel/ChapterToolbar.vue`：新增章节工具栏组件
- `src/components/novel/ChapterContentPanel.vue`：新增章节内容面板组件
- `src/components/novel/VolumesList.vue`：新增卷和章节列表组件
- `src/components/dialogs/`：新增多个对话框组件用于章节和卷管理
- `src/components/novel/`：新增多个弹出框组件
- `src/services/proxy-service.ts`：增强代理服务，支持默认配置和域名匹配
- `src/utils/domain-utils.ts`：新增域名提取工具
- `src/services/character-setting-service.ts`：优化角色设置服务
- `src/services/terminology-service.ts`：优化术语服务
- `src/stores/books.ts`：优化书籍存储，改进章节内容加载
- `src/stores/settings.ts`：增强设置存储，支持默认代理配置
- `src/services/ai/tasks/polish-service.ts`：优化润色服务
- `src/services/ai/tasks/translation-service.ts`：优化翻译服务

### 新增依赖
- `co`：用于异步操作的协程库

---

## 🎯 用户体验改进

1. **界面组织优化**：通过组件化重构，界面结构更加清晰，操作更加直观
2. **章节管理增强**：新增的章节工具栏和内容面板使章节管理更加便捷
3. **代理设置简化**：默认代理配置和智能域名匹配大大简化了代理设置流程
4. **操作反馈改进**：增强的撤销/重做功能和操作统计提供更好的操作反馈
5. **翻译体验提升**：自动折叠非活动任务和优化的进度显示使翻译过程更加专注
6. **代码质量提升**：大幅重构减少了代码复杂度，提升了应用的稳定性和可维护性

---

## 📊 统计数据

- **新增功能**: 7 项
- **改进优化**: 4 项
- **问题修复**: 4 项
- **代码变更**: 约 11,932 行新增，5,715 行删除
- **新增组件**: 10+ 个组件
- **重构文件**: 1 个主要页面文件（BookDetailsPage.vue）

---

## 🔄 升级建议

本次更新是一次重大的界面重构和功能增强更新，主要聚焦于：

1. **章节管理体验**：通过组件化重构，章节管理功能更加完善和易用
2. **代理设置优化**：默认配置和智能匹配使代理设置更加便捷
3. **代码质量提升**：大幅重构减少了代码复杂度，提升了应用的稳定性和可维护性

建议所有用户升级以获得更好的使用体验。特别是章节管理功能的增强和代理设置的优化将显著提升日常使用效率。

---

## 📚 相关文档

- 项目架构文档：`AGENTS.md`
- 翻译指南：`docs/TRANSLATION_GUIDE.md`
- 主题指南：`docs/THEME_GUIDE.md`
- 组合函数检查报告：`docs/COMPOSABLES_CHECK_REPORT.md`
- 组合函数测试摘要：`docs/COMPOSABLES_TESTS_SUMMARY.md`

---

## 🙏 致谢

感谢所有为本次版本做出贡献的开发者。

---

*本文档由自动化工具生成，如有疑问请提交 Issue。*

