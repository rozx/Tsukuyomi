# 发布说明 - v0.7.4

## 版本信息
- **版本号**: 0.7.4
- **发布日期**: 2025年12月11日

---

## 🎉 新功能

### 1. 待办事项会话 ID 支持
- **会话关联增强**：
  - 新增待办事项的会话 ID（`sessionId`）支持，使待办事项能够更好地关联到助手聊天会话
  - 更新 `TodoItem` 接口，新增可选的 `sessionId` 属性，增强待办事项与聊天会话的关联性
  - 优化待办事项过滤逻辑，优先按会话 ID 过滤，提升任务相关性
  - 增强待办事项创建和管理功能，确保待办事项正确关联到对应的会话
- **服务与工具集成**：
  - 更新待办事项服务方法，支持基于会话的待办事项检索逻辑
  - 优化待办事项工具，增强会话 ID 支持
  - 改进待办事项在助手服务中的集成方式，提升整体功能性和用户体验

### 2. 助手任务管理增强
- **会话创建优化**：
  - 更新 `createNewSession` 函数，在创建新会话前自动停止所有正在进行的助手任务
  - 确保新会话的干净启动，避免任务冲突和状态混乱
  - 改进助手任务的生命周期管理
- **任务停止功能**：
  - 在 `AIProcessingStore` 中新增停止所有活动任务的方法
  - 新增专门停止助手相关任务的方法
  - 提升任务管理的精确性和可控性
- **任务监控改进**：
  - 增强主布局中的任务监控器，更有效地处理已取消的任务
  - 为多个取消操作提供统一的 Toast 通知
  - 为错误情况提供单独的通知，改进错误反馈的清晰度

---

## 🔧 改进与优化

### 任务状态管理优化
- **状态更新增强**：
  - 增强任务状态更新逻辑，区分已取消和错误状态
  - 允许更准确的任务管理和状态跟踪
  - 改进任务状态的表示和处理方式
- **性能优化**：
  - 更新 `AIProcessingStore`，防止对已完成或已取消的任务进行不必要的状态更新
  - 提升任务管理的效率，减少不必要的操作

### 代码质量提升
- **HTML 结构优化**：
  - 清理并格式化 `index.html` 结构
  - 改进代码可读性和维护性
  - 优化 HTML 文档的组织结构

### 错误处理改进
- **任务错误处理**：
  - 增强任务状态更新中的错误处理逻辑
  - 区分不同类型的错误状态，提供更精确的错误反馈
  - 改进错误情况的用户提示和处理流程

---

## 🐛 问题修复

### 任务管理修复
- **会话切换修复**：
  - 修复创建新会话时可能存在旧任务干扰的问题
  - 确保会话切换时任务状态的正确清理
  - 改进任务取消逻辑的可靠性

### 待办事项修复
- **会话关联修复**：
  - 修复待办事项在助手会话中关联不准确的问题
  - 确保待办事项正确过滤到对应的会话
  - 改进待办事项检索的相关性

### 状态管理修复
- **任务状态同步**：
  - 修复任务状态更新中的潜在竞争条件
  - 改进已完成和已取消任务的状态处理
  - 确保任务状态的准确同步

---

## 📝 技术细节

### 主要修改文件
- `src/services/todo-list-service.ts`：新增会话 ID 支持，优化待办事项过滤逻辑（+20 行）
- `src/services/ai/tasks/todo-helper.ts`：增强待办事项辅助函数，支持会话 ID（+16 行）
- `src/services/ai/tasks/assistant-service.ts`：集成会话 ID 支持，改进错误处理（+43 行）
- `src/services/ai/tools/todo-list-tools.ts`：优化待办事项工具，支持会话 ID（+16 行）
- `src/services/ai/tools/types.ts`：新增会话 ID 类型定义（+1 行）
- `src/stores/ai-processing.ts`：新增任务停止方法，优化状态更新逻辑（+23 行）
- `src/components/layout/AppRightPanel.vue`：集成会话 ID 支持，优化助手任务处理（+28 行）
- `src/layouts/MainLayout.vue`：增强任务监控器，改进取消任务处理（+65 行）
- `index.html`：清理并格式化 HTML 结构（-198 行，+317 行）
- `package.json`：版本号更新至 0.7.4（+1 行）
- `src/constants/version.ts`：版本号更新至 0.7.4（+1 行）

### 新增功能统计
- **新增功能**: 2 项
- **改进优化**: 3 项
- **问题修复**: 3 项
- **代码变更**: 约 339 行新增，198 行删除
- **修改文件**: 12 个文件

---

## 🎯 用户体验改进

1. **会话管理优化**：新增的会话 ID 支持使待办事项能够更精确地关联到对应的助手会话，提升了任务管理的准确性和相关性
2. **任务切换改进**：优化后的会话创建流程确保新会话启动时自动清理旧任务，提供了更干净和可控的使用体验
3. **错误反馈增强**：改进的任务监控和错误处理提供了更清晰和及时的反馈，帮助用户更好地了解任务状态
4. **任务控制提升**：新增的任务停止功能增强了用户对任务执行的控制能力，提升了任务管理的灵活性
5. **代码质量提升**：优化的 HTML 结构和改进的错误处理提升了应用的稳定性和可维护性

---

## 🔄 升级建议

本次更新主要聚焦于：

1. **待办事项会话关联**：会话 ID 支持的引入使待办事项能够更精确地关联到助手会话，特别适合在多个会话间切换使用的场景
2. **任务管理增强**：优化的任务停止和状态管理功能提供了更好的任务控制能力，提升了应用的可控性和稳定性
3. **错误处理改进**：增强的错误处理和状态区分提供了更准确的反馈，有助于更好地理解和管理任务执行状态

建议所有用户升级以获得更好的使用体验。特别是助手会话的待办事项管理和任务切换功能将显著提升多会话使用场景下的体验。

---

## 📚 相关文档

- 项目架构文档：`AGENTS.md`
- 翻译指南：`docs/TRANSLATION_GUIDE.md`
- 主题指南：`docs/THEME_GUIDE.md`
- 组合函数检查报告：`docs/COMPOSABLES_CHECK_REPORT.md`
- 组合函数测试摘要：`docs/COMPOSABLES_TESTS_SUMMARY.md`

---

## 🙏 致谢

感谢所有为本次版本做出贡献的开发者。

---

*本文档由自动化工具生成，如有疑问请提交 Issue。*
