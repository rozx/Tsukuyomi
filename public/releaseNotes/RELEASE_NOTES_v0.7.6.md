# 发布说明 - v0.7.6

## 版本信息
- **版本号**: 0.7.6
- **发布日期**: 2025年12月14日

---

## 🎉 新功能

### 1. 操作信息工具系统
- **统一的操作报告系统**：
  - 新增 `action-info-utils.ts` 工具模块，提供统一的操作信息处理和展示功能
  - 实现 `ActionInfo` 到 `MessageAction` 的转换，统一处理所有操作类型的字段映射
  - 支持详细的操作详情生成，包括操作类型、实体类型、相关数据等
  - 提供操作详情格式化功能，生成用户友好的操作描述
- **操作详情展示增强**：
  - 支持翻译操作的详细信息展示，包括段落 ID、翻译 ID、新旧翻译内容对比
  - 支持批量替换操作的统计信息展示，包括替换的段落数和翻译数
  - 支持术语和角色操作的详细信息展示
  - 支持章节和书籍操作的上下文信息展示
- **集成与优化**：
  - 在 `AppRightPanel` 组件中集成操作信息工具，增强消息操作展示
  - 优化批量翻译功能，集成增强的操作报告功能
  - 改进操作信息的格式化和展示逻辑

### 2. 自动同步逻辑增强
- **模型同步优化**：
  - 增强 AI 模型的自动同步逻辑，优先使用 `lastEdited` 时间戳判断同步状态
  - 支持基于时间戳的精确同步判断，避免不必要的冲突
  - 改进模型删除检测逻辑，区分远程新添加和本地已删除的模型
  - 优化模型同步的准确性和可靠性
- **书籍同步优化**：
  - 增强书籍的自动同步逻辑，使用 `lastEdited` 时间戳进行精确判断
  - 改进书籍合并逻辑，确保章节内容的完整性
  - 优化书籍删除检测，区分远程新添加和本地已删除的书籍
  - 提升书籍同步的准确性和数据完整性
- **封面历史同步优化**：
  - 增强封面历史的自动同步逻辑，使用 `addedAt` 时间戳进行判断
  - 改进封面同步的准确性，避免不必要的冲突
  - 优化封面删除检测逻辑

### 3. 翻译规范化增强
- **引号处理优化**：
  - 增强翻译文本中的引号规范化功能
  - 改进引号转换逻辑，保护已存在的「」引号不被错误转换
  - 优化半角引号到全角日语引号的转换规则
  - 支持更准确的引号风格保持
- **标点符号规范化**：
  - 增强标点符号的规范化处理，确保翻译文本格式一致
  - 支持更多标点符号的全角转换
  - 改进规范化逻辑的准确性和可靠性
- **测试覆盖增强**：
  - 新增翻译规范化测试用例，覆盖引号处理和标点符号转换
  - 增强测试覆盖范围，确保规范化功能的正确性

### 4. 翻译任务后处理提示优化
- **后处理选项增强**：
  - 更新翻译任务的后处理提示选项，提供更清晰的操作指导
  - 优化任务完成后的后续操作提示
  - 改进任务状态转换的用户体验

---

## 🔧 改进与优化

### 代码简化与重构
- **角色和术语服务简化**：
  - 移除角色设置中的分数（scores）处理，简化数据模型
  - 移除术语和角色服务中的出现次数（occurrences）处理逻辑
  - 简化组件中的数据展示逻辑，移除不必要的分数显示
  - 减少代码复杂度，提升可维护性
- **组件代码清理**：
  - 从多个组件中移除角色分数相关的代码
  - 简化 `CharacterSettingPanel`、`SettingCard`、`TerminologyPanel` 等组件
  - 优化组件的数据处理逻辑

### 构建流程优化
- **构建环境配置**：
  - 设置 `NODE_ENV` 为 `production`，确保构建行为的一致性
  - 改进构建配置，提升构建的可靠性和可重复性
  - 优化构建流程的环境变量管理

### 批量翻译功能增强
- **操作报告集成**：
  - 增强批量翻译功能的操作报告能力
  - 集成操作信息工具，提供更详细的批量操作反馈
  - 改进批量操作的可见性和可追踪性

---

## 🐛 问题修复

### 数据同步修复
- **同步逻辑修复**：
  - 修复自动同步中可能出现的模型、书籍和封面数据冲突问题
  - 改进基于时间戳的同步判断逻辑，确保数据一致性
  - 修复本地删除检测的准确性，避免误删数据

### 代码质量修复
- **类型安全改进**：
  - 修复类型定义中的不一致问题
  - 改进代码的类型安全性
  - 优化类型检查的准确性

---

## 📝 技术细节

### 主要修改文件
- `src/utils/action-info-utils.ts`：新增操作信息工具模块（+851 行）
- `src/composables/useAutoSync.ts`：增强自动同步逻辑，优化模型、书籍和封面同步（+78 行）
- `src/utils/translation-normalizer.ts`：增强翻译规范化功能，优化引号处理（+76 行）
- `src/services/ai/tasks/ai-task-helper.ts`：更新后处理提示选项（+9 行）
- `src/components/layout/AppRightPanel.vue`：集成操作信息工具，优化消息展示（+849 行，-部分代码）
- `src/services/character-setting-service.ts`：移除出现次数处理，简化服务逻辑（-372 行）
- `src/services/terminology-service.ts`：移除出现次数处理，简化服务逻辑（-164 行）
- `src/services/sync-data-service.ts`：优化同步数据服务（+32 行）
- `src/utils/occurrence-utils.ts`：移除出现次数工具（-60 行）
- `src/__tests__/translation-normalizer.test.ts`：增强翻译规范化测试（+33 行）
- `src/__tests__/character-setting-service.test.ts`：更新测试，移除分数相关测试（-8 行）
- `src/__tests__/terminology-service.test.ts`：更新测试（-1 行）
- `src/components/novel/CharacterSettingPanel.vue`：移除分数显示（-3 行）
- `src/components/novel/SettingCard.vue`：移除分数显示（-7 行）
- `src/components/novel/TerminologyPanel.vue`：简化组件（-4 行）
- `src/components/novel/ParagraphCard.vue`：移除分数相关代码（-2 行）
- `src/components/novel/ChapterContentPanel.vue`：简化组件（-2 行）
- `src/composables/book-details/useChapterManagement.ts`：移除分数相关代码（-8 行）
- `src/composables/book-details/useEditMode.ts`：简化代码（-4 行）
- `src/pages/BookDetailsPage.vue`：移除分数相关代码（-13 行）
- `src/models/novel.ts`：移除分数字段（-2 行）
- `src/services/ai/tools/character-tools.ts`：简化工具逻辑（+9 行）
- `src/services/ai/tools/terminology-tools.ts`：简化工具逻辑（+8 行）
- `src/services/ai/tools/paragraph-tools.ts`：优化批量替换功能（+106 行，-部分代码）
- `src/services/ai/tools/types.ts`：更新类型定义（+14 行，-部分代码）
- `src/stores/chat-sessions.ts`：优化会话存储（+15 行）
- `package.json`：版本号更新至 0.7.6（+1 行）
- `src/constants/version.ts`：版本号更新至 0.7.6（+1 行）
- `.github/workflows/release.yml`：新增发布工作流（+11 行）
- `Dockerfile`：优化构建配置（+1 行）
- `scripts/build.sh`：优化构建脚本（+1 行）
- `src-electron/electron-main.ts`：优化 Electron 主进程（+99 行）

### 新增功能统计
- **新增功能**: 4 项
- **改进优化**: 3 项
- **问题修复**: 2 项
- **代码变更**: 约 1794 行新增，1317 行删除
- **修改文件**: 37 个文件

---

## 🎯 用户体验改进

1. **操作可见性提升**：新增的操作信息工具系统使所有 AI 操作更加透明和可追踪，用户可以清楚地了解每个操作的详细信息
2. **同步可靠性增强**：优化的自动同步逻辑使用时间戳进行精确判断，显著提升了数据同步的准确性和可靠性
3. **翻译质量提升**：增强的翻译规范化功能确保翻译文本格式的一致性，特别是引号处理的改进提升了翻译质量
4. **代码简化**：移除不必要的分数和出现次数处理，简化了代码结构，提升了应用的性能和可维护性
5. **构建稳定性提升**：优化的构建配置确保了构建过程的一致性和可靠性

---

## 🔄 升级建议

本次更新主要聚焦于：

1. **操作追踪增强**：新增的操作信息工具系统提供了更详细的操作报告，特别适合需要追踪 AI 操作详情的用户
2. **数据同步优化**：增强的自动同步逻辑使用时间戳进行精确判断，显著提升了多设备同步的可靠性
3. **翻译质量改进**：优化的翻译规范化功能，特别是引号处理的改进，提升了翻译文本的格式一致性
4. **代码质量提升**：简化的代码结构移除了不必要的功能，提升了应用的性能和可维护性
5. **构建流程优化**：改进的构建配置确保了构建过程的一致性和可靠性

建议所有用户升级以获得更好的使用体验。特别是自动同步逻辑的优化和操作信息工具系统将显著提升数据管理和操作追踪的能力。

---

## 📚 相关文档

- 项目架构文档：`AGENTS.md`
- 翻译指南：`docs/TRANSLATION_GUIDE.md`
- 主题指南：`docs/THEME_GUIDE.md`
- 批量替换示例：`docs/batch-replace-examples.md`

---

## 🙏 致谢

感谢所有为本次版本做出贡献的开发者。

---

*本文档由自动化工具生成，如有疑问请提交 Issue。*

