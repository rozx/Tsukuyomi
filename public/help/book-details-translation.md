# 🤖 章节翻译与段落处理

本页说明书籍详情中的 AI 翻译能力（翻译、润色、校对）以及对应的进度与设置。

## 🎯 支持的任务类型

- **翻译**：为段落生成译文。
- **润色**：对已有译文进行优化。
- **校对**：对已有译文进行校验与修正。

> 说明：润色与校对都要求段落已存在译文；未翻译段落不会被这两类章节任务处理。

---

## 📖 章节级操作（工具栏按钮）

章节工具栏右侧的主按钮会根据当前章节翻译状态自动变化：

### 1) 全部未翻译时

- 按钮文本：`翻译本章`
- 点击行为：翻译本章全部**非空段落**
- 此时是普通按钮（无下拉菜单）

### 2) 部分已翻译时

- 按钮文本：`继续翻译`
- 点击行为：仅翻译未译段落（已译段落跳过）
- 此时是下拉按钮，菜单包含：
  - `重新翻译`（全章重译）

### 3) 全部已翻译时

- 按钮文本：`润色本章`
- 点击行为：润色本章所有已译非空段落
- 此时是下拉按钮，菜单包含：
  - `重新翻译`
  - `校对本章`

### 4) 执行中状态

- 翻译或润色执行中，按钮会显示加载状态并禁用。
- 章节任务可随时取消（见下文进度面板）。

---

## 📝 段落级操作

每个段落可独立进行 AI 处理：

- `重新翻译`
- `润色段落`
- `校对段落`

同时支持：

- `解释选中文本`（需要先选中文本）
- `复制原文到助手`
- `翻译历史 (N)`（有历史版本时显示）

段落 AI 处理完成后会写入该段落翻译版本，并可在历史中切换。

---

## 📊 翻译进度面板

### 自动与手动显示

- 当章节翻译/润色/校对开始时，右侧进度面板会自动显示。
- 可通过工具栏 `列表` 图标手动显示/隐藏。

### 顶部进度区

- 显示当前任务类型（正在翻译/润色/校对章节）
- 显示当前工作章节
- 进度条与 `current / total`
- `取消` 按钮可停止当前任务

### AI 任务历史区

面板会展示最近的翻译相关任务（翻译/润色/校对），包含：

- 任务状态（进行中、已完成、错误、已取消）
- 模型名、任务类型、耗时
- 工作章节
- 任务内容区（可折叠）
  - `思考过程`
  - `输出内容`
  - `待办事项`（有数据时）
- 单任务 `停止` 按钮（仅进行中任务）
- 自动滚动、自动标签切换开关
- `清除已完成/错误/已取消的任务`

---

## ⚙️ 翻译设置（章节工具栏“翻译设置”）

点击工具栏 `翻译设置`（齿轮）可配置：

### 全局设置（书籍级）

- 过滤行首空格（缩进）
- 显示时规范化符号
- 显示时规范化标题
- 跳过 AI 追问（ask_user）
- 翻译任务分块大小（字符数）

### 章节设置（当前章节）

- 翻译指令
- 润色指令
- 校对指令

这些章节指令会附加到对应任务提示词，仅作用于当前章节。

---

## 🔍 与翻译配套的编辑能力

- 可直接编辑译文；支持 `Enter` 保存、`Shift+Enter` 换行、`Esc` 取消。
- 可用搜索与替换批量修正文案（替换写回译文原始数据）。

---

## ⚠️ 实际行为说明

- 章节翻译按“非空段落”计数与处理。
- 取消任务后，已完成写入的段落会保留。
- 若章节已全部翻译，主按钮默认行为是“润色本章”，不是“再次全章翻译”。
