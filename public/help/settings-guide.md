# ⚙️ 设置使用指南

本文档仅说明当前版本已实现的设置能力，按设置弹窗中的选项卡组织。

---

## 📌 打开与关闭

- 入口：左侧导航栏 **设置**。
- 关闭：点击弹窗右上角关闭按钮。
- 设置弹窗会记住你上次打开的选项卡。

---

## 🧭 选项卡总览

当前设置弹窗包含以下选项卡：

1. AI 模型
2. 代理设置（仅浏览器版显示）
3. API Keys
4. 同步设置
5. 爬虫设置
6. 导入/导出

> 在 Electron 桌面版中，不显示“代理设置”选项卡。

---

## 1) 🤖 AI 模型

用于配置“任务默认模型”。

### 支持的默认任务

- 翻译
- 校对和润色
- 术语翻译 / 章节摘要
- 助手

### 选择规则（当前实现）

- 下拉框只显示：
  - 已启用的模型；
  - 且该模型在对应任务上被标记为支持默认任务。
- 每个任务都可以选择 `未设置`。
- 如果已选模型后续被禁用或不再支持该任务，设置会自动清空。

---

## 2) 🌐 代理设置（仅浏览器版）

用于配置“爬虫与网络工具”的代理行为。

### 基础开关

- **启用代理**：开启后，爬虫和网络工具会优先走代理。
- **自动切换代理服务**：请求失败时按顺序尝试其他代理。
- **自动添加映射**：自动切换成功后，将该代理写入对应网站映射。

### 默认代理与代理 URL

- 可从“选择代理服务”下拉中选择。
- 代理 URL 支持模板：`...{url}`。
- 当选择了列表中的代理服务时，URL 输入框会被锁定为对应项。

### 代理列表管理

- 添加代理（名称、URL、可选描述）
- 编辑代理
- 删除代理
- 测试代理（测试目标为 `https://www.duckduckgo.com`）
- 拖拽排序（影响优先级）

### 网站-代理映射

- 可为网站单独配置代理列表（按优先级顺序）。
- 每个网站最多配置 **3** 个代理。
- 支持启用/禁用单条映射。
- 支持在映射编辑弹窗中调整代理顺序。

### 重要说明

- 该选项卡只在非 Electron 环境显示。
- 即使关闭代理，浏览器版对部分内置站点仍会走应用内 `/api/...` 路径。
- 浏览器版 AI 模型请求使用独立的默认 CORS 代理逻辑，不受此处“代理 URL”直接控制。

---

## 3) 🔑 API Keys

当前该选项卡仅提供：

- **Tavily 搜索 API Key**（用于助手网络搜索能力）

交互行为：

- 点击“保存”后写入本地设置。
- 清空后保存可移除该 Key。
- 界面会显示“已配置 / 未配置”状态。

---

## 4) 🔄 同步设置（GitHub Gist）

用于配置并执行 Gist 同步。

### 基础配置

- 启用 Gist 同步
- GitHub 用户名
- GitHub Personal Access Token
- Gist ID（可选，留空可在上传时创建）

### 操作按钮

- **验证 Token**
- **上传到 Gist**
- **从 Gist 下载**（未填 Gist ID 时不可用）

### 自动同步

- 可启用“自动同步”。
- 同步间隔范围：**1~1440 分钟**。

### 修订历史

启用且有 Gist ID 时可查看修订历史：

- 刷新历史
- 展开单个修订查看文件变更
- 恢复到指定修订

### 删除 Gist

- 可执行“删除当前 Gist”（需确认）。

### 恢复与覆盖行为（当前实现）

- 从修订恢复时，会先清空本地书籍、AI 模型、封面历史，再应用远程数据。
- 普通下载流程中，若检测到可恢复项，会弹出恢复对话框供选择。

---

## 5) 🕷️ 爬虫设置

仅包含一项：

- **并发数限制 (1~10)**

说明：

- 建议值为 3。
- 该值用于控制爬虫并发请求数量。

---

## 6) 💾 导入/导出

### 导出资料

导出为本地 JSON 文件，文件名格式：

- `tsukuyomi-settings-YYYY-MM-DD.json`

导出数据包含（当前实现）：

- AI 模型
- 书籍（含章节内容）
- 封面历史
- Memory
- 同步配置
- 应用设置

### 导入资料

- 支持文件类型：`.json`、`.txt`（内容需为可解析 JSON）。

导入行为（按当前实现）：

- AI 模型：有数据时先清空再导入。
- 书籍：有数据时先清空再导入。
- 封面历史：有数据时先清空再导入。
- Memory：按书籍逐条创建（不会先全量清空）。
- 应用设置：执行设置导入逻辑。
- 同步配置：有数据时覆盖当前同步配置。

> 导入不是“按字段精细选择”的流程；操作前建议先导出备份。

---

## ❓ 常见问题

### Q1：为什么桌面版看不到“代理设置”？

A：代理设置选项卡只在浏览器版显示。

### Q2：API Keys 里为什么没有 OpenAI / Gemini Key？

A：模型 API Key 在“AI 列表”中的模型编辑弹窗内配置，不在这里。

### Q3：导入后数据不符合预期怎么办？

A：先确认导入文件结构与内容；建议始终先导出一份当前本地备份，再执行导入。

### Q4：同步按钮可用但下载按钮灰色？

A：通常是未填写 Gist ID，或当前处于同步中。

---

## 📚 相关文档

- [AI 模型配置](/help/ai-models-guide)
- [聊天助手](/help/chat-assistant-guide)
- [顶部工具栏](/help/toolbar-guide)
- [书籍列表页](/help/books-page-guide)
