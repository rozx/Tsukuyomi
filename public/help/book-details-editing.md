# ✏️ 内容编辑与搜索替换

本页说明章节内容区的编辑行为、段落操作和快捷键（以当前实现为准）。

## 🧭 三种编辑模式

可在章节工具栏切换：

1. **原文编辑**（铅笔图标）
2. **翻译模式**（语言图标）
3. **译文预览**（眼睛图标）

默认模式为**翻译模式**。

## 📝 原文编辑模式

### 进入方式

- 点击工具栏「原文编辑」按钮后，自动进入整章原文编辑状态。

### 编辑与保存

- 章节原文在一个大文本框中编辑。
- 点击**保存**后，系统会按换行重新生成段落。

段落处理规则（当前实现）：

- 新文本按行拆分为段落；
- 与原段落同索引位置比较：
  - 文本未变：保留该段已有翻译；
  - 文本变更：清空该段翻译；
- 新增行会生成新段落（无翻译）；
- 被移除的旧段落随之移除。

### 取消编辑

- 点击**取消**，放弃本次原文修改并回到翻译模式。
- 章节切换时，如仍在原文编辑，状态会被重置。

## 🌐 翻译模式（段落级编辑）

### 基本交互

- 每段显示原文与当前选中译文；
- 可直接编辑当前译文；
- 回车保存，Shift+Enter 换行，Esc 取消本次编辑；
- 段落可显示术语/角色高亮。

### 段落右键菜单

右键段落可打开上下文菜单，包含：

- 解释选中文本（仅当段落原文有选中内容时显示）
- 校对段落
- 润色段落
- 重新翻译
- 复制原文到助手
- 翻译历史（仅当该段存在历史版本时显示）

### 翻译历史

- 历史对话框最多显示最近 5 条版本；
- 可从历史中切换当前使用版本。

## 👁️ 译文预览模式

- 以阅读视图显示译文为主；
- 未翻译段会显示「未翻译」标记并展示原文；
- 适合快速通读与审阅。

## 🔍 搜索与替换

### 打开与关闭

- `Ctrl+F`：打开/关闭搜索栏；
- `Ctrl+H`：打开或切换替换区域；
- `Esc`：关闭搜索栏（搜索栏打开时）。

### 搜索

- 在搜索框中输入后会定位匹配段落；
- `F3` / `Shift+F3` 或按钮可在匹配项间切换。

### 替换

- 可替换当前匹配或全部匹配；
- 替换基于“原始译文文本”执行（不是显示层格式化后的文本）；
- 进行“全部替换”时会记录撤销点，可用撤销恢复。

## ↩️ 撤销 / 重做

- `Ctrl+Z`：撤销（非输入框场景）
- `Ctrl+Y` 或 `Ctrl+Shift+Z`：重做（非输入框场景）

当前实现限制：

- 历史最多保留 50 条；
- 切换章节会清空当前章节编辑历史。

## ⌨️ 章节页常用快捷键

| 快捷键                | 功能                           |
| --------------------- | ------------------------------ |
| `Ctrl+F`              | 打开/关闭搜索                  |
| `Ctrl+H`              | 打开/关闭替换区域              |
| `F3`                  | 下一个匹配（搜索打开时）       |
| `Shift+F3`            | 上一个匹配（搜索打开时）       |
| `Esc`                 | 关闭搜索栏（搜索打开时）       |
| `Ctrl+Shift+C`        | 复制当前章节所有已翻译文本     |
| `Ctrl+Z`              | 撤销（非输入框）               |
| `Ctrl+Y/Ctrl+Shift+Z` | 重做（非输入框）               |
| `↑/↓`                 | 翻译模式下段落导航（跳过空段） |
| `Enter`               | 翻译模式下开始编辑选中段落     |

说明：

- 段落方向键导航仅在**翻译模式**生效；
- 若焦点在输入框中，大部分全局快捷键不会接管；
- 部分弹层（如下拉/菜单/对话框）中会保留方向键默认行为。
