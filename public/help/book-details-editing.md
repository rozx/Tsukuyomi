# ✍️ 内容编辑功能

书籍详情页提供了强大的内容编辑功能,支持编辑原文和译文,提供多种编辑模式和辅助工具。

## 🎯 编辑模式

书籍详情页支持三种编辑模式,可以通过工具栏的编辑模式切换按钮进行切换:

### 1. 只读模式 (Read-Only)

- **用途**: 浏览和阅读章节内容
- **特点**: 不允许编辑原文和译文
- **适用场景**: 审阅翻译结果、校对内容

**视觉提示**:

- 段落不显示编辑按钮
- 鼠标悬停不显示编辑提示
- 整体呈现阅读友好的样式

### 2. 编辑译文模式 (Edit Translation)

- **用途**: 编辑和润色译文内容
- **特点**: 只能编辑译文,原文保持只读
- **适用场景**: 翻译后的人工校对和润色

**操作方式**:

- 点击译文区域开始编辑
- 双击译文快速进入编辑状态
- 使用键盘快捷键快速定位段落

### 3. 编辑原文模式 (Edit Original)

- **用途**: 编辑和修正原文内容
- **特点**:
  - 可以编辑整个章节的原文
  - 编辑时会将原文按段落分割
  - 保存时自动更新段落结构
- **适用场景**: 修正OCR错误、调整段落划分

**操作方式**:

- 切换到编辑原文模式
- 工具栏会显示"编辑原文"按钮
- 点击按钮进入全文编辑状态

## 📝 编辑译文

### 单击段落编辑

**操作步骤**:

1. 确保处于"编辑译文"模式
2. 点击要编辑的译文段落
3. 段落会进入编辑状态,显示文本框
4. 修改译文内容
5. 点击"保存"按钮或按 Enter 键保存
6. 点击"取消"按钮或按 Esc 键取消编辑

**编辑提示**:

- 编辑框支持多行文本
- 可以使用 Shift+Enter 换行
- 单独按 Enter 键会保存并退出编辑

### 快捷键编辑

**编辑模式下的快捷键**:

- **上/下方向键**: 导航到上一个/下一个段落
- **Enter**: 开始编辑当前选中的段落
- **Esc**: 取消编辑并退出编辑状态
- **Tab**: 保存当前段落并编辑下一个段落

### 批量编辑

虽然不支持同时编辑多个段落,但可以通过以下方式提高效率:

**使用键盘导航**:

1. 使用方向键选择段落
2. 按 Enter 开始编辑
3. 修改内容
4. 按 Tab 保存并跳到下一个段落
5. 重复步骤3-4

**使用搜索替换**:

- 对于需要统一修改的内容
- 使用搜索替换功能批量处理
- 详见"搜索与替换"章节

### 译文多版本管理

每个段落可以保存多个译文版本:

**查看译文版本**:

1. 在段落下方找到译文版本选择器
2. 下拉菜单显示所有译文版本
3. 选择不同版本查看内容

**创建新版本**:

- AI 翻译会自动创建新的译文版本
- 手动编辑不会创建新版本,而是更新当前版本

**版本命名规则**:

- `Translation #1`: 第一个翻译版本
- `Translation #2`: 第二个翻译版本
- 可以通过版本号区分不同的翻译批次

**切换译文版本**:

1. 点击段落下方的译文选择器
2. 选择要使用的版本
3. 选中的版本会高亮显示
4. 该版本会作为当前的显示译文

## 编辑原文

### 进入原文编辑

**操作步骤**:

1. 切换到"编辑原文"模式
2. 点击工具栏的"编辑原文"按钮
3. 整个章节会显示在一个大的文本编辑框中
4. 编辑框下方显示"保存"和"取消"按钮

**编辑说明**:

- 编辑框显示整个章节的原文
- 段落之间用换行符分隔
- 可以自由添加或删除段落
- 支持复制粘贴大段文本

### 保存原文修改

**操作步骤**:

1. 完成原文编辑
2. 点击"保存"按钮
3. 系统会自动:
   - 按空行分割段落
   - 为新段落创建默认译文
   - 保留现有段落的译文
   - 更新段落顺序

**段落匹配规则**:

- 如果原文段落未变化,保留原有译文
- 如果原文段落被修改,译文会被标记为"需要更新"
- 新增的段落会自动创建空的译文
- 删除的段落及其译文会被移除

### 取消原文编辑

**操作步骤**:

1. 点击"取消"按钮或按 Esc 键
2. 编辑框关闭,原文恢复到编辑前的状态
3. 所有修改都会被放弃

**注意事项**:

- 取消操作不可撤销
- 建议在大量修改前先导出备份
- 可以使用浏览器的撤销功能(Ctrl+Z)恢复编辑框内的修改

## 🔧 段落操作

### 段落工具栏

每个段落在悬停时会显示操作按钮栏:

**重新翻译** (Re-translate):

- 图标: 🔄
- 功能: 使用 AI 重新翻译该段落
- 保留历史版本,创建新的译文版本

**润色** (Polish):

- 图标: ✨
- 功能: 使用 AI 润色当前译文
- 更新当前译文版本

**校对** (Proofread):

- 图标: ✓
- 功能: 使用 AI 校对当前译文
- 修正语法错误和表达问题

**更多操作** (⋮):

- 复制原文
- 复制译文
- 删除译文
- 查看段落历史

### 段落状态显示

**未翻译**:

- 译文区域显示占位提示
- 背景色较暗
- 可以直接开始翻译

**翻译中**:

- 显示加载动画
- 译文区域显示"翻译中..."
- 不可编辑

**已翻译**:

- 显示译文内容
- 可以编辑和选择版本
- 可以进行润色和校对

**有多个版本**:

- 段落下方显示版本选择器
- 当前版本高亮显示
- 可以快速切换版本

### 段落导航

**键盘导航**:

- **向上方向键**: 选择上一个段落
- **向下方向键**: 选择下一个段落
- **Home**: 跳转到第一个段落
- **End**: 跳转到最后一个段落

**鼠标导航**:

- 点击段落可以选中段落
- 选中的段落会高亮显示
- 双击段落开始编辑

**滚动到段落**:

- 选择段落后自动滚动到视图内
- 使用平滑滚动动画
- 保持段落在屏幕中央

## ↩️ 撤销和重做

### 撤销功能

**支持的操作**:

- ✓ 编辑译文
- ✓ 编辑原文
- ✓ 添加/删除章节
- ✓ 移动章节
- ✓ 编辑章节信息

**不支持的操作**:

- ✗ AI 翻译操作(翻译、润色、校对)
- ✗ 删除译文版本
- ✗ 导入导出操作

**操作步骤**:

1. 点击工具栏的撤销按钮
2. 或使用快捷键 Ctrl+Z
3. 系统会恢复到上一个状态
4. 撤销按钮上悬停可以查看撤销的操作描述

### 重做功能

**操作步骤**:

1. 执行撤销操作后
2. 点击工具栏的重做按钮
3. 或使用快捷键 Ctrl+Y / Ctrl+Shift+Z
4. 系统会重新应用被撤销的操作

### 历史记录限制

- 最多保留 **50 次** 操作历史
- 切换到其他章节会清空历史记录
- 刷新页面会清空历史记录

### 撤销的最佳实践

1. **频繁保存状态**: 在进行大规模修改前,先导出当前版本
2. **小步快跑**: 将大的修改分解为多个小步骤,便于撤销
3. **验证后再继续**: 每次修改后检查结果,确保符合预期
4. **注意历史限制**: 不要在单个章节中进行过多操作

## 🔍 搜索与替换

### 打开搜索工具栏

**操作步骤**:

1. 点击工具栏的搜索按钮(🔍 图标)
2. 或使用快捷键 Ctrl+F
3. 搜索工具栏会在主工具栏下方展开

### 搜索内容

**操作步骤**:

1. 在搜索框中输入要查找的文本
2. 系统会实时高亮显示所有匹配项
3. 搜索框旁显示匹配数量
4. 使用"上一个/下一个"按钮导航

**搜索范围**:

- 默认只搜索译文
- 可以选择同时搜索原文
- 搜索区分大小写

**搜索技巧**:

- 支持正则表达式搜索
- 可以使用通配符匹配
- 支持全词匹配选项

### 替换内容

**单个替换**:

1. 点击"显示替换"按钮
2. 在替换框中输入替换文本
3. 使用"上一个/下一个"导航到目标匹配项
4. 点击"替换"按钮替换当前匹配项

**批量替换**:

1. 在替换框中输入替换文本
2. 点击"全部替换"按钮
3. 系统会显示替换数量
4. 可以使用撤销功能恢复替换

**替换预览**:

- 替换前会高亮显示要替换的内容
- 替换后新内容会以不同颜色显示
- 可以撤销替换操作

### 关闭搜索工具栏

**操作步骤**:

- 点击搜索工具栏的关闭按钮
- 或按 Esc 键
- 或再次点击工具栏的搜索按钮

## 🌟 辅助功能

### 术语高亮

**自动高亮**:

- 系统会自动检测原文和译文中的术语
- 术语文本会有颜色标记
- 鼠标悬停显示术语详细信息

**术语弹窗**:

- 点击工具栏的术语按钮查看当前章节使用的术语
- 显示术语列表和使用次数
- 可以快速添加或编辑术语

### 角色高亮

**自动高亮**:

- 系统会自动检测原文和译文中的角色名
- 角色名会有颜色标记
- 鼠标悬停显示角色详细信息

**角色弹窗**:

- 点击工具栏的角色按钮查看当前章节出现的角色
- 显示角色列表和出现次数
- 可以快速添加或编辑角色设定

### 章节内跳转

**段落链接**:

- 在译文中可以引用其他段落
- 点击链接快速跳转到目标段落
- 返回按钮可以跳回原位置

**书签功能**:

- 可以为重要段落添加书签
- 快速访问书签段落
- 书签在侧边栏显示

## 🎨 格式化

### 译文格式化选项

**自动格式化**:

- 自动调整标点符号(中英文混排)
- 自动处理空格(中英文之间)
- 自动调整引号(「」 或 """)

**段落格式**:

- 首行缩进设置
- 段落间距设置
- 对话格式设置

### 保存格式设置

- 格式设置会保存到章节配置中
- 每个章节可以有独立的格式设置
- 可以应用全局默认格式

## 📤 导出编辑内容

### 导出选项

**导出格式**:

- 纯文本 (.txt)
- Markdown (.md)
- EPUB 电子书
- PDF 文档

**导出内容**:

- 只导出原文
- 只导出译文
- 导出原文和译文(对照)

**导出范围**:

- 当前章节
- 当前卷
- 整本书

### 导出操作

**操作步骤**:

1. 点击工具栏的导出按钮
2. 选择导出格式
3. 选择导出内容和范围
4. 点击"导出"按钮
5. 选择保存位置

详细导出选项请参考"导出功能指南"。

## 💡 最佳实践

### 编辑工作流

**推荐流程**:

1. **AI 初译**: 使用 AI 翻译整个章节
2. **快速审阅**: 切换到只读模式,通读全文
3. **段落润色**: 切换到编辑译文模式,逐段修改
4. **术语统一**: 使用搜索替换统一术语翻译
5. **最终校对**: 使用只读模式再次通读

### 避免常见错误

- ❌ 在编辑原文时误删段落
- ❌ 忘记保存就切换章节
- ❌ 大量修改后不导出备份
- ✓ 频繁使用撤销功能验证修改
- ✓ 使用版本管理保留历史译文
- ✓ 定期导出重要章节

### 提高效率的技巧

**使用键盘快捷键**:

- 掌握段落导航快捷键
- 使用 Tab 快速批量编辑
- 使用 Ctrl+F 快速查找

**利用 AI 辅助**:

- 对于不满意的译文,使用"重新翻译"
- 使用"润色"功能提升译文质量
- 使用"校对"功能检查语法错误

**合理组织工作**:

- 先翻译多个章节,再统一润色
- 集中处理同一类问题(如术语统一)
- 使用搜索替换提高批量修改效率

## ❓ 常见问题

### 为什么编辑后内容没有保存?

1. 检查是否点击了"保存"按钮
2. 确认没有在保存前切换章节或刷新页面
3. 查看是否有错误提示信息

### 如何恢复误删的段落?

1. 如果刚删除,使用撤销功能 (Ctrl+Z)
2. 如果已经保存,需要从导出的备份中恢复
3. 建议定期导出重要章节作为备份

### 编辑原文后译文消失了?

编辑原文可能会导致段落重新匹配。如果原文变化较大,系统可能无法正确匹配译文。建议:

1. 大规模修改原文前先导出当前译文
2. 使用撤销功能恢复
3. 如果无法恢复,可以手动粘贴译文

### 为什么有些段落无法编辑?

1. 检查是否处于"只读"模式
2. 确认段落没有正在进行 AI 翻译
3. 检查是否有其他错误状态

### 搜索替换后如何撤销?

- 使用撤销功能 (Ctrl+Z) 可以撤销搜索替换操作
- 如果已经切换章节,撤销历史会被清空
- 建议在大规模替换前导出备份
