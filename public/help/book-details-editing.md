# 内容编辑功能

书籍详情页提供了强大的内容编辑功能，支持编辑原文和译文，提供多种编辑模式和辅助工具。

## ✏️ 编辑模式

书籍详情页支持三种编辑模式，可以通过工具栏的编辑模式切换按钮进行切换：

### 1. ✏️ 原文编辑模式 (Edit Original)

- 🎯 **用途**: 编辑和修正原文内容
- 🖊️ **图标**: 铅笔图标
- ✨ **特点**:
  - 📝 可以编辑整个章节的原文
  - 📄 编辑时将原文按段落分割
  - 💾 保存时自动更新段落结构

**操作方式**:

- 切换到原文编辑模式后自动进入编辑状态
- 显示整个章节原文的编辑框
- 编辑完成后点击"保存"或"取消"

### 2. 🌐 翻译模式 (Translation Mode)

- 🎯 **用途**: 浏览原文并编辑译文
- 🌐 **图标**: 语言图标
- ✨ **特点**:
  - 📌 默认模式
  - 👆 可以点击段落编辑译文
  - ⌨️ 支持键盘导航在段落间移动

**操作方式**:

- 点击段落进入编辑状态
- 使用方向键在段落间导航
- 按 Enter 开始编辑选中的段落

### 3. 👁️ 译文预览模式 (Preview)

- 🎯 **用途**: 预览翻译结果
- 👁️ **图标**: 眼睛图标
- ✨ **特点**:
  - 📝 只显示译文内容
  - 📖 方便阅读和审阅
  - 🔒 不显示原文

**适用场景**:

- 审阅翻译结果
- 检查译文的流畅度
- 校对最终内容

## 编辑译文

### 点击段落编辑

**操作步骤**:

1. 确保处于"翻译模式"
2. 点击要编辑的译文段落
3. 段落会进入编辑状态，显示文本框
4. 修改译文内容
5. 点击保存按钮或点击其他区域保存
6. 按 Esc 键取消编辑

### 键盘导航编辑

**翻译模式下的快捷键**:

- **上/下方向键**: 在段落之间导航（跳过空段落）
- **Enter**: 开始编辑当前选中的段落
- **Esc**: 取消编辑并退出编辑状态

**导航说明**:

- 方向键会自动跳过空段落
- 选中的段落会高亮显示
- 使用方向键时页面会自动滚动到选中段落

### 译文多版本管理

每个段落可以保存多个译文版本：

**查看译文版本**:

1. 在段落下方找到译文版本选择器
2. 下拉菜单显示所有译文版本
3. 选择不同版本查看内容

**创建新版本**:

- AI 翻译会自动创建新的译文版本
- 手动编辑会更新当前版本

**切换译文版本**:

1. 点击段落下方的译文选择器
2. 选择要使用的版本
3. 选中的版本会作为当前的显示译文

## 编辑原文

### 进入原文编辑

**操作步骤**:

1. 切换到"原文编辑"模式（点击铅笔图标）
2. 自动进入原文编辑状态
3. 整个章节会显示在一个大的文本编辑框中
4. 编辑框下方显示"保存"和"取消"按钮

**编辑说明**:

- 编辑框显示整个章节的原文
- 段落之间用换行符分隔
- 可以自由添加或删除段落
- 支持复制粘贴大段文本

### 保存原文修改

**操作步骤**:

1. 完成原文编辑
2. 点击"保存"按钮
3. 系统会自动:
   - 按换行符分割段落
   - 为新段落创建默认结构
   - 保留现有段落的译文（如果原文未改变）
   - 清除已修改段落的译文

**段落匹配规则**:

- 如果原文段落未变化，保留原有译文
- 如果原文段落被修改，译文会被清除
- 新增的段落会创建空的译文
- 删除的段落及其译文会被移除

### 取消原文编辑

**操作步骤**:

1. 点击"取消"按钮或按 Esc 键
2. 编辑框关闭，原文恢复到编辑前的状态
3. 切换回翻译模式

**注意事项**:

- 取消操作会放弃所有修改
- 切换章节时会自动重置编辑状态

## 段落操作

### 段落工具栏

每个段落在悬停时会显示操作按钮栏：

**重新翻译** (Re-translate):

- 功能: 使用 AI 重新翻译该段落
- 保留历史版本，创建新的译文版本

**润色** (Polish):

- 功能: 使用 AI 润色当前译文
- 更新当前译文版本

**校对** (Proofread):

- 功能: 使用 AI 校对当前译文
- 修正语法错误和表达问题

**更多操作**:

- 复制原文
- 复制译文
- 其他操作

### 段落状态显示

**未翻译**:

- 译文区域显示占位提示
- 可以直接开始翻译

**翻译中**:

- 显示加载动画
- 译文区域显示进度
- 不可编辑

**已翻译**:

- 显示译文内容
- 可以编辑和选择版本
- 可以进行润色和校对

**有多个版本**:

- 段落下方显示版本选择器
- 当前版本高亮显示
- 可以快速切换版本

## 撤销和重做

### 撤销功能

**支持的操作**:

- 编辑译文
- 编辑原文
- 添加/删除章节
- 移动章节
- 编辑章节信息

**操作步骤**:

1. 点击工具栏的撤销按钮
2. 或使用快捷键 Ctrl+Z（非输入框状态）
3. 系统会恢复到上一个状态

### 重做功能

**操作步骤**:

1. 执行撤销操作后
2. 点击工具栏的重做按钮
3. 或使用快捷键 Ctrl+Y / Ctrl+Shift+Z（非输入框状态）
4. 系统会重新应用被撤销的操作

### 历史记录限制

- 最多保留 **50 次** 操作历史
- 切换到其他章节会清空历史记录
- 刷新页面会清空历史记录

## 搜索与替换

### 打开搜索工具栏

**操作步骤**:

1. 点击工具栏的搜索按钮
2. 或使用快捷键 Ctrl+F
3. 搜索工具栏会在主工具栏下方展开

### 搜索内容

**操作步骤**:

1. 在搜索框中输入要查找的文本
2. 系统会实时高亮显示所有匹配项
3. 搜索框旁显示匹配数量
4. 使用"上一个/下一个"按钮导航
5. 或使用 F3 / Shift+F3 快捷键

### 替换内容

**打开替换功能**:

1. 点击"显示替换"按钮
2. 或使用快捷键 Ctrl+H

**单个替换**:

1. 在替换框中输入替换文本
2. 使用导航找到目标匹配项
3. 点击"替换"按钮替换当前匹配项

**批量替换**:

1. 在替换框中输入替换文本
2. 点击"全部替换"按钮
3. 系统会显示替换数量
4. 可以使用撤销功能恢复替换

### 关闭搜索工具栏

**操作步骤**:

- 点击搜索工具栏的关闭按钮
- 或按 Esc 键
- 或再次点击工具栏的搜索按钮

## 键盘快捷键

### 全局快捷键

| 快捷键                | 功能                       |
| --------------------- | -------------------------- |
| Ctrl+F                | 打开/关闭搜索              |
| Ctrl+H                | 打开搜索并显示替换         |
| F3                    | 下一个匹配项（搜索开启时） |
| Shift+F3              | 上一个匹配项（搜索开启时） |
| Esc                   | 关闭搜索工具栏             |
| Ctrl+Shift+C          | 复制所有已翻译文本         |
| Ctrl+Z                | 撤销（非输入框状态）       |
| Ctrl+Y / Ctrl+Shift+Z | 重做（非输入框状态）       |

### 翻译模式下的快捷键

| 快捷键   | 功能               |
| -------- | ------------------ |
| 上方向键 | 选择上一个非空段落 |
| 下方向键 | 选择下一个非空段落 |
| Enter    | 开始编辑选中的段落 |

**注意**:

- 方向键导航会自动跳过空段落
- 选中段落时会自动滚动到可见区域
- 在输入框中时快捷键会被禁用

## 导出编辑内容

### 复制译文

**快速复制**:

- 使用 Ctrl+Shift+C 复制当前章节所有译文
- 或点击工具栏的导出按钮

### 导出选项

**导出格式**:

- 纯文本 (.txt)
- JSON 数据 (.json)

**导出内容**:

- 只导出原文
- 只导出译文
- 导出原文和译文（对照）

## 最佳实践

### 编辑工作流

**推荐流程**:

1. **AI 初译**: 使用 AI 翻译整个章节
2. **快速审阅**: 切换到预览模式，通读全文
3. **段落润色**: 切换到翻译模式，逐段修改
4. **术语统一**: 使用搜索替换统一术语翻译
5. **最终校对**: 使用预览模式再次通读

### 避免常见错误

- 在编辑原文时注意段落分割
- 编辑原文后检查译文是否被正确保留
- 大量修改后使用撤销功能验证
- 使用版本管理保留历史译文

### 提高效率的技巧

**使用键盘快捷键**:

- 掌握段落导航快捷键
- 使用 Ctrl+F 快速查找
- 使用 Ctrl+Z 随时撤销

**利用 AI 辅助**:

- 对于不满意的译文，使用"重新翻译"
- 使用"润色"功能提升译文质量
- 使用"校对"功能检查语法错误

## 常见问题

### 为什么编辑后内容没有保存？

1. 确认是否正确完成了编辑操作
2. 检查是否在保存前切换了模式或章节
3. 查看是否有错误提示信息

### 如何恢复误删的段落？

1. 如果刚删除，使用撤销功能 (Ctrl+Z)
2. 如果已经保存，需要从备份中恢复
3. 建议定期导出重要章节作为备份

### 编辑原文后译文消失了？

这是正常行为。当原文被修改时，对应的译文会被清除，因为原有译文可能不再准确。建议：

1. 大规模修改原文前先导出当前译文
2. 修改后重新翻译相关段落

### 为什么有些段落无法编辑？

1. 检查是否处于正确的编辑模式
2. 确认段落没有正在进行 AI 翻译
3. 检查是否在预览模式下

### 搜索替换后如何撤销？

- 使用撤销功能 (Ctrl+Z) 可以撤销搜索替换操作
- 如果已经切换章节，撤销历史会被清空
- 建议在大规模替换前导出备份
